# MySQL 安装并重置密码

---

## MySQL 安装

## 检查是否安装了mysql

```
# 检查是否安装了mysql
rpm -qa| grep -i mysql
```

```
# 关闭mysql服务
killall mysqld
```

使用 `find / -name mysql` 查找出所有的mysql删除对应的文件夹

### 彻底卸载mysql

```
# 查找出所有的mysql对应的文件夹
find / -name mysql
```

### 删除对应的mysql目录

```
rm -rf /etc/logrotate.d/mysql
rm -rf /etc/selinux/targeted/active/modules/100/mysql
rm -rf /var/lib/mysql
rm -rf /var/lib/mysql/mysql
rm -rf /usr/bin/mysql
rm -rf /usr/lib64/mysql
rm -rf /usr/share/mysql
```

## 检查操作系统

```
# 查看linux版本是centos还是redhat
cat /etc/redhat-release 
```

```
CentOS Linux release 7.7.1908 (Core)
```

### 查看linux系统是64位还是32位

```
getconf LONG_BIT
```

## 下载MySQL 

方法1: 到[MySQL官网](https://dev.mysql.com/downloads/mysql/)下载安装包(64位)

方法2: 使用wget下载

```
wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.25-linux-glibc2.12-x86_64.tar.gz
```

方法3: 使用两台linux服务器之前传送文件，速度最快。

```
scp mysql-5.7.25-linux-glibc2.12-x86_64.tar.gz root@192.168.1.110: /home/app/soft
```

### 解压包文件

```
cd /home/app/soft
tar -zxvf mysql-5.7.25-linux-glibc2.12-x86_64.tar.gz
mv  mysql-5.7.25-linux-glibc2.12-x86_64 /usr/local/mysql

```

方法4: 安装

```
yum -y install mysql-community-server
```

## 配置编译

### 创建data目录

```
cd /usr/local/mysql
mkdir data
```

### 检查mysql组和用户

```
cat /etc/group | grep mysql
```

```eq
# eq:
mysql:x:27:
```

```
cat /etc/passwd | grep mysql
```

```eq
# eq:
mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false
```

```
# useradd -r参数表示mysql用户是系统用户，不可用于登录系统
groupadd mysql
useradd -r -g mysql mysql
```

将 `/usr/local/mysql`的所有者及所属组改为 `mysql`

```
# 修改所有者和组
chown -R mysql.mysql /usr/local/mysql
```

### 创建 `my_default.cnf` 文件

因为 `mysql 5.7` 版本开始 `my_default.cnf` 文件不会自带，需要手动创建。

```
cd /usr/local/mysql/support-files
vi  my_default.cnf
```

在 `/usr/local/mysql/support-files` 目录下创建 `my_default.cnf`

```
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.


[mysqld]
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES 

basedir = /usr/local/mysql
datadir = /usr/local/mysql/data
port = 3306
socket = /tmp/mysql.sock
character-set-server=utf8

log-error = /usr/local/mysql/data/mysqld.log
pid-file = /usr/local/mysql/data/mysqld.pid
```

拷贝`my_default.cnf`到`/etc/my.cnf`

```
cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf
```

### 初始化 mysqld

```
cd /usr/local/mysql/bin
./mysqld --initialize --user=mysql --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data/
```

初始化完成之后，查看日志

```
tail -f  /usr/local/mysql/data/mysqld.log
```

### 设置开机启动 `MySQL`

```
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
```

启动mysql并设置为开机自启动服务

```
[root@localhost testdemo]# chkconfig mysqld on
注意：正在将请求转发到“systemctl enable mysqld.service”。
```

```
[root@localhost testdemo]#  service mysqld start
Redirecting to /bin/systemctl start mysqld.service
```
检查mysql服务状态，检查是否启动

```
service mysqld status
```

第一次启动mysql，会在日志文件中生成root用户的一个随机密码，使用下面命令查看该密码

```
[root@localhost testdemo]# grep 'temporary password' /var/log/mysqld.log
2019-12-01T06:08:34.916067Z 1 [Note] A temporary password is generated for root@localhost: 1G8dEy(Wk8op
```

登录mysql(输入随机产生的密码   1G8dEy(Wk8op    不显示不要以为没有输入)

```
[root@localhost testdemo]# mysql -uroot -p
Enter password: 
```

登录成功显示如下

```
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.7.28

Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
```

### 修改root密码(密码要有大小写字母和字符)

```
mysql>  ALTER USER 'root'@'localhost' IDENTIFIED BY '#new password#';

# success message
Query OK, 0 rows affected (0.00 sec)
```

## 启动/停止/重启 `MySQL`服务

```
# 启动mysql
service mysqld start
```

```
# 停止mysql
service mysqld stop
```

```
# 重启mysql
service mysqld restart
```

```
# 查看运行状态
service mysqld status
```

```
# 查看mysql进程
ps -ef | grep mysql
```

```
# 结束mysql进程
kill -9 # 进程号

# 或 
killall mysqld
```

## MySQL5.7重置root密码

### 第一步：修改配置文件免密码登录mysql

```
vi /etc/my.cnf  
# 在my.cnf的[mysqld]字段加入
skip-grant-tables

# 重启mysql服务
service mysqld restart
```

### 第二步：免密码登录mysql

```
mysql -u root 
# password 直接回车
```

### 第三步：给root重置密码为空

```
mysql> use mysql;
# mysql 5.7.9以后废弃了password字段,字段名修改为authentication_string
mysql> update user set authentication_string='' where user='root';
# 刷新数据库
mysql> flush privileges;
```

### 第四步： root重置密码

退出mysql，删除/etc/my.cnf文件最后的 skip-grant-tables 重启mysql服务，使用root用户进行登录，因为上面设置了authentication_string为空，所以可以免密码登录。

```
ALERT USER 'root'@'localhost' IDENTIFIED BY '#新密码#';
```